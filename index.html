<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DIGIY PAY â€” Abonnement</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body{font-family:Arial;background:#0b1020;color:#fff;padding:20px}
.card{background:#111827;padding:20px;border-radius:12px;max-width:520px;margin:auto}
input,select,button{width:100%;padding:12px;margin-top:10px;border-radius:8px;border:1px solid rgba(255,255,255,.2);background:#0f172a;color:#fff}
button{cursor:pointer;font-weight:bold}
.small{font-size:13px;opacity:.8;margin-top:8px}
</style>
</head>
<body>

<div class="card">
<h2>ðŸ¦… DIGIY PAY</h2>

<select id="module">
<option value="DRIVER">DRIVER</option>
<option value="LOC">LOC</option>
<option value="RESTO">RESTO</option>
<option value="POS">POS</option>
<option value="MARKET">MARKET</option>
</select>

<input id="phone" placeholder="TÃ©lÃ©phone (ex: 221771234567)"/>

<button id="payBtn">Continuer</button>

<div class="small" id="msg"></div>
</div>

<script>
const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
const SUPABASE_ANON ="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

function digitsOnly(p){ return (p||"").replace(/\D/g,""); }

document.getElementById("payBtn").onclick = async function(){

  const module = document.getElementById("module").value;
  const phone = digitsOnly(document.getElementById("phone").value);

  if(!phone || phone.length < 9){
    document.getElementById("msg").textContent = "TÃ©lÃ©phone invalide.";
    return;
  }

  const ref = "PAY_" + Date.now();

  const { error } = await sb.from("digiy_pay_orders").insert({
    phone: phone,
    plan: "standard",
    amount: 12900,
    status: "pending",
    slug: module.toLowerCase()+"-"+phone,
    proof_path: null,
    code: null
  });

  if(error){
    document.getElementById("msg").textContent = error.message;
    return;
  }

  window.location.href = "/wait.html?ref="+ref;
};
</script>

</body>
</html>
